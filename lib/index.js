'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var _createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_download=require('download'),_download2=_interopRequireDefault(_download),_moment=require('moment'),moment=_interopRequireWildcard(_moment),_path=require('path'),_path2=_interopRequireDefault(_path),_storage=require('@google-cloud/storage');function _interopRequireWildcard(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _asyncToGenerator(a){return function(){var b=a.apply(this,arguments);return new Promise(function(a,c){function d(e,f){try{var g=b[e](f),h=g.value}catch(a){return void c(a)}return g.done?void a(h):Promise.resolve(h).then(function(a){d('next',a)},function(a){d('throw',a)})}return d('next')})}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var oneHour=moment().add(1,'hours').format(),GCS=function(){function a(b,c){var d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:'./';_classCallCheck(this,a);var e=new _storage.Storage({projectId:b});this.myBucket=e.bucket(c),this.tempPath=_path2.default.join(d,'temp')}return _createClass(a,[{key:'downloadToLocal',value:function(){var a=_asyncToGenerator(regeneratorRuntime.mark(function a(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:'';return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,(0,_download2.default)(b,this.tempPath);case 3:a.next=8;break;case 5:a.prev=5,a.t0=a['catch'](0),console.log(a.t0);case 8:return a.abrupt('return',_path2.default.join(this.tempPath,_path2.default.basename(b)));case 9:case'end':return a.stop();}},a,this,[[0,5]])}));return function downloadToLocal(){return a.apply(this,arguments)}}()},{key:'checkExists',value:function(){var a=_asyncToGenerator(regeneratorRuntime.mark(function a(b){var c;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,this.myBucket.file(b).exists();case 3:return c=a.sent,a.abrupt('return',c[0]);case 7:a.prev=7,a.t0=a['catch'](0),console.log(a.t0);case 10:return a.abrupt('return',!1);case 11:case'end':return a.stop();}},a,this,[[0,7]])}));return function checkExists(){return a.apply(this,arguments)}}()},{key:'getSignedUrl',value:function(){var a=_asyncToGenerator(regeneratorRuntime.mark(function a(b){var c,d=1<arguments.length&&void 0!==arguments[1]?arguments[1]:oneHour;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,this.myBucket.file(b).getSignedUrl({action:'read',expires:d});case 3:return c=a.sent,a.abrupt('return',c[0]);case 7:a.prev=7,a.t0=a['catch'](0),console.log(a.t0);case 10:return a.abrupt('return',!1);case 11:case'end':return a.stop();}},a,this,[[0,7]])}));return function getSignedUrl(){return a.apply(this,arguments)}}()},{key:'upload',value:function(){var a=_asyncToGenerator(regeneratorRuntime.mark(function a(b,c){var d;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,this.myBucket.upload(b,{destination:c,metadata:{contentDisposition:'attachment; filename="'+_path2.default.basename(c)+'"'}});case 3:return d=a.sent,a.abrupt('return',d);case 7:a.prev=7,a.t0=a['catch'](0),console.log(a.t0);case 10:return a.abrupt('return',!1);case 11:case'end':return a.stop();}},a,this,[[0,7]])}));return function upload(){return a.apply(this,arguments)}}()}]),a}();exports.default=GCS,module.exports=exports['default'];